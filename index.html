<!DOCTYPE html>
<html>
<head>
  <title>Pranika Hotel Billing</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f0f2f5; margin:0; }
    .container { max-width: 600px; margin: 30px auto; background: #fff; border-radius:10px; box-shadow:0 2px 8px rgba(0,0,0,0.12); padding:30px;}
    h2 { text-align: center; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px;}
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background: #eee; }
    button, input[type="number"] { margin: 2px; }
    .btn { border:none; border-radius: 5px; padding: 5px 10px; cursor:pointer; }
    .btn-add { background: #218838; color: white; }
    .btn-remove {background: #dc3545; color:white;}
    .btn-print {background: #007bff; color:white; margin-top:16px;}
    .report-btn {background: #856404; color:#fff;}
    .backup-btn {background: #343a40; color: #fff;}
    .item-photo { width: 70px; height: 70px; object-fit: cover; border-radius: 6px; box-shadow:0 1px 3px rgba(0,0,0,0.18); }
    .small-photo { width: 50px; height: 50px; }
    .tagline { text-align: center; margin-top: -10px; color:#777; font-size: 0.9rem; }
  </style>
</head>
<body>
<div class="container">
  <h2>Pranika Hotel Billing</h2>
  <div class="tagline">Authentic South Indian delights served fresh every day</div>
  <table>
    <tr><th>Item</th><th>Image</th><th>Price</th><th>Add</th></tr>
    <tbody id="item-list"></tbody>
  </table>

  <h3>Cart</h3>
  <table>
    <tr><th>Item</th><th>Image</th><th>Qty</th><th>Subtotal</th><th>Set Qty</th><th>Remove</th></tr>
    <tbody id="cart-list"></tbody>
  </table>
  <div style="margin-top:10px; text-align:right;"><strong>Total: ₹<span id="total">0</span></strong></div>
  <button class="btn btn-print" onclick="printBill()">Print Bill</button>
  <hr>
  <button class="btn report-btn" onclick="showReport('daily')">Daily Report</button>
  <button class="btn report-btn" onclick="showReport('monthly')">Monthly Report</button>
  <button class="btn backup-btn" onclick="backupData()">Backup to Local</button>
  <div id="report-output" style="margin-top:15px;"></div>
</div>

<script>
// Menu items and prices
const items = [
  {name:'Idly', price: 10, image:'https://via.placeholder.com/80?text=Idly'},
  {name:'Vada', price: 12, image:'https://via.placeholder.com/80?text=Vada'},
  {name:'Dosa', price: 30, image:'https://via.placeholder.com/80?text=Dosa'},
  {name:'Tea', price: 8, image:'https://via.placeholder.com/80?text=Tea'},
  {name:'Coffee', price: 12, image:'https://via.placeholder.com/80?text=Coffee'},
];

let cart = [];

// Render item list
function renderItems() {
  let html = '';
  items.forEach((item, idx) => {
    html += `<tr>
      <td>${item.name}</td>
      <td><img src="${item.image}" alt="${item.name}" class="item-photo"></td>
      <td>₹${item.price}</td>
      <td><button class="btn btn-add" onclick="addToCart(${idx})">Add</button></td>
    </tr>`;
  });
  document.getElementById("item-list").innerHTML = html;
}

// Render cart
function renderCart() {
  let html = '';
  cart.forEach((ci, idx) => {
    html += `<tr>
      <td>${ci.name}</td>
      <td><img src="${ci.image}" alt="${ci.name}" class="item-photo small-photo"></td>
      <td>${ci.qty}</td>
      <td>₹${ci.qty*ci.price}</td>
      <td>
        <input type="number" min="1" value="${ci.qty}" onchange="setQty(${idx},this.value)">
      </td>
      <td><button class="btn btn-remove" onclick="removeFromCart(${idx})">Remove</button></td>
    </tr>`
  });
  document.getElementById("cart-list").innerHTML = html;
  document.getElementById("total").innerText = cart.reduce((s,c)=>s+c.qty*c.price,0);
}

function addToCart(idx) {
  let item = items[idx];
  let found = cart.find(ci=>ci.name===item.name);
  if(found)
    {
      found.qty++;
      found.image = item.image;
    }
  else
    cart.push({name:item.name, price:item.price, image:item.image, qty:1});
  renderCart();
}

function removeFromCart(idx) {
  cart.splice(idx,1);
  renderCart();
}

function setQty(idx,v) {
  let val = parseInt(v)||1;
  cart[idx].qty = val;
  renderCart();
}

// Print the bill
function printBill() {
  if(!cart.length) {alert("Cart is empty!"); return;}
  let data = {
    ts: new Date().toISOString(),
    bill: JSON.parse(JSON.stringify(cart)),
    total: cart.reduce((s,c)=>s+c.qty*c.price,0)
  };
  // Save bill to localStorage
  let allBills = JSON.parse(localStorage.getItem('bills')||"[]");
  allBills.push(data);
  localStorage.setItem('bills',JSON.stringify(allBills));

  // Print bill popup
  let billWindow = window.open('', '', 'width=400,height=600');
  billWindow.document.write('<h2>Pranika Hotel</h2><table border="1" style="width:100%;border-collapse:collapse;"><tr><th>Item</th><th>Qty</th><th>Subtotal</th></tr>');
  cart.forEach(item=>{
    billWindow.document.write(`<tr>
      <td>${item.name}</td>
      <td>${item.qty}</td>
      <td>₹${item.qty*item.price}</td>
    </tr>`);
  });
  billWindow.document.write(`<tr><td colspan="2" style="text-align:right;"><b>Total</b></td><td><b>₹${data.total}</b></td></tr>`);
  billWindow.document.write(`<tr><td colspan="3" style="text-align:right;font-size:small;">${new Date(data.ts).toLocaleString()}</td></tr>`);
  billWindow.document.write('</table>');
  billWindow.print();
  billWindow.close();
  cart = [];
  renderCart();
}

// Reports
function showReport(type) {
  let bills = JSON.parse(localStorage.getItem('bills')||"[]");
  if (!bills.length) { document.getElementById("report-output").innerHTML = 'No data found.'; return;}
  let now = new Date();
  let filterFn;
  if(type==='daily'){
    let y = now.getFullYear(), m = now.getMonth(), d = now.getDate();
    filterFn = b => {
      let dt = new Date(b.ts);
      return dt.getFullYear()===y && dt.getMonth()===m && dt.getDate()===d;
    };
  } else if (type==='monthly'){
    let y = now.getFullYear(), m = now.getMonth();
    filterFn = b => {
      let dt = new Date(b.ts);
      return dt.getFullYear()===y && dt.getMonth()===m;
    };
  }
  let filtered = bills.filter(filterFn);
  let total = filtered.reduce((s,b)=>s + b.total, 0);
  let count = filtered.length;

  let detail = {};
  filtered.forEach(bill=>{
    bill.bill.forEach(it=>{
      if(!detail[it.name]) detail[it.name]=0;
      detail[it.name] += it.qty;
    });
  });

  let html = `<b>${type==='daily'?'Daily':'Monthly'} Report</b><br>`;
  html += `Number of Bills: ${count}<br>`;
  html += `Total Sales: ₹${total}<br>`;
  html += '<table border="1" style="margin-top:8px;background:white"><tr><th>Item</th><th>Qty Sold</th></tr>';
  for(let k in detail)
    html += `<tr><td>${k}</td><td>${detail[k]}</td></tr>`;
  html += '</table>';
  document.getElementById("report-output").innerHTML = html;
}

// Backup bills as JSON file
function backupData() {
  let bills = localStorage.getItem('bills')||"[]";
  let blob = new Blob([bills],{type:'application/json'});
  let a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "bills_backup_"+(new Date).toISOString().slice(0,10)+".json";
  a.click();
}

renderItems();
renderCart();
</script>
</body>
</html>

